(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Aria2=f()}})((function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){var n=e[i][1][r];return o(n||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";const Aria2=require("./lib/Aria2");module.exports=Aria2},{"./lib/Aria2":2}],2:[function(require,module,exports){"use strict";const JSONRPCClient=require("./JSONRPCClient");function prefix(str){if(!str.startsWith("system.")&&!str.startsWith("aria2.")){str="aria2."+str}return str}function unprefix(str){const suffix=str.split("aria2.")[1];return suffix||str}class Aria2 extends JSONRPCClient{addSecret(parameters){let params=this.secret?["token:"+this.secret]:[];if(Array.isArray(parameters)){params=params.concat(parameters)}return params}_onnotification(notification){const{method:method,params:params}=notification;const event=unprefix(method);if(event!==method)this.emit(event,params);return super._onnotification(notification)}async call(method,...params){return super.call(prefix(method),this.addSecret(params))}async multicall(calls){const multi=[calls.map((([method,...params])=>({methodName:prefix(method),params:this.addSecret(params)})))];return super.call("system.multicall",multi)}async batch(calls){return super.batch(calls.map((([method,...params])=>[prefix(method),this.addSecret(params)])))}async listNotifications(){const events=await this.call("system.listNotifications");return events.map((event=>unprefix(event)))}async listMethods(){const methods=await this.call("system.listMethods");return methods.map((method=>unprefix(method)))}}Object.assign(Aria2,{prefix:prefix,unprefix:unprefix});Aria2.defaultOptions=Object.assign({},JSONRPCClient.defaultOptions,{secure:false,host:"localhost",port:6800,secret:"",path:"/jsonrpc"});module.exports=Aria2},{"./JSONRPCClient":4}],3:[function(require,module,exports){"use strict";module.exports=function Deferred(){this.promise=new Promise(((resolve,reject)=>{this.resolve=resolve;this.reject=reject}))}},{}],4:[function(require,module,exports){(function(global){(function(){"use strict";const Deferred=require("./Deferred");const promiseEvent=require("./promiseEvent");const JSONRPCError=require("./JSONRPCError");const _WebSocket=require("ws");const _fetch=require("node-fetch");const EventEmitter=require("events");const WebSocket=global.WebSocket||_WebSocket;const fetch=global.fetch?global.fetch.bind(global):_fetch;class JSONRPCClient extends EventEmitter{constructor(options){super();this.deferreds=Object.create(null);this.lastId=0;Object.assign(this,this.constructor.defaultOptions,options)}id(){return this.lastId++}url(protocol){return protocol+(this.secure?"s":"")+"://"+this.host+":"+this.port+this.path}websocket(message){return new Promise(((resolve,reject)=>{const cb=err=>{if(err)reject(err);else resolve()};this.socket.send(JSON.stringify(message),cb);if(global.WebSocket&&this.socket instanceof global.WebSocket)cb()}))}async http(message){const response=await this.fetch(this.url("http"),{method:"POST",body:JSON.stringify(message),headers:{Accept:"application/json","Content-Type":"application/json"}});response.json().then((msg=>this._onmessage(msg))).catch((err=>{this.emit("error",err)}));return response}_buildMessage(method,params){if(typeof method!=="string"){throw new TypeError(method+" is not a string")}const message={method:method,"json-rpc":"2.0",id:this.id()};if(params)Object.assign(message,{params:params});return message}async batch(calls){const promises=[];const message=calls.map((([method,params])=>this._buildMessage(method,params)));await this._send(message);return message.map((({id:id})=>{const{promise:promise}=this.deferreds[id]=new Deferred;return promise}))}async call(method,parameters){const message=this._buildMessage(method,parameters);await this._send(message);const{promise:promise}=this.deferreds[message.id]=new Deferred;return promise}async _send(message){this.emit("output",message);const{socket:socket}=this;return socket&&socket.readyState===1?this.websocket(message):this.http(message)}_onresponse({id:id,error:error,result:result}){const deferred=this.deferreds[id];if(!deferred)return;if(error)deferred.reject(new JSONRPCError(error));else deferred.resolve(result);delete this.deferreds[id]}_onrequest({method:method,params:params}){return this.onrequest(method,params)}_onnotification({method:method,params:params}){this.emit(method,params)}_onmessage(message){this.emit("input",message);if(Array.isArray(message)){for(const object of message){this._onobject(object)}}else{this._onobject(message)}}_onobject(message){if(message.method===undefined)this._onresponse(message);else if(message.id===undefined)this._onnotification(message);else this._onrequest(message)}async open(){const socket=this.socket=new this.WebSocket(this.url("ws"));socket.onclose=(...args)=>{this.emit("close",...args)};socket.onmessage=event=>{let message;try{message=JSON.parse(event.data)}catch(err){this.emit("error",err);return}this._onmessage(message)};socket.onopen=(...args)=>{this.emit("open",...args)};socket.onerror=(...args)=>{this.emit("error",...args)};return promiseEvent(this,"open")}async close(){const{socket:socket}=this;socket.close();return promiseEvent(this,"close")}}JSONRPCClient.defaultOptions={secure:false,host:"localhost",port:80,secret:"",path:"/jsonrpc",fetch:fetch,WebSocket:WebSocket};module.exports=JSONRPCClient}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Deferred":3,"./JSONRPCError":5,"./promiseEvent":6,events:8,"node-fetch":7,ws:7}],5:[function(require,module,exports){"use strict";module.exports=class JSONRPCError extends Error{constructor({message:message,code:code,data:data}){super(message);this.code=code;if(data)this.data=data;this.name=this.constructor.name}}},{}],6:[function(require,module,exports){"use strict";module.exports=function promiseEvent(target,event){return new Promise(((resolve,reject)=>{function cleanup(){target.removeListener(event,onEvent);target.removeListener("error",onError)}function onEvent(data){resolve(data);cleanup()}function onError(err){reject(err);cleanup()}target.addListener(event,onEvent);target.addListener("error",onError)}))}},{}],7:[function(require,module,exports){},{}],8:[function(require,module,exports){"use strict";var R=typeof Reflect==="object"?Reflect:null;var ReflectApply=R&&typeof R.apply==="function"?R.apply:function ReflectApply(target,receiver,args){return Function.prototype.apply.call(target,receiver,args)};var ReflectOwnKeys;if(R&&typeof R.ownKeys==="function"){ReflectOwnKeys=R.ownKeys}else if(Object.getOwnPropertySymbols){ReflectOwnKeys=function ReflectOwnKeys(target){return Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target))}}else{ReflectOwnKeys=function ReflectOwnKeys(target){return Object.getOwnPropertyNames(target)}}function ProcessEmitWarning(warning){if(console&&console.warn)console.warn(warning)}var NumberIsNaN=Number.isNaN||function NumberIsNaN(value){return value!==value};function EventEmitter(){EventEmitter.init.call(this)}module.exports=EventEmitter;module.exports.once=once;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=undefined;var defaultMaxListeners=10;function checkListener(listener){if(typeof listener!=="function"){throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof listener)}}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:true,get:function(){return defaultMaxListeners},set:function(arg){if(typeof arg!=="number"||arg<0||NumberIsNaN(arg)){throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+arg+".")}defaultMaxListeners=arg}});EventEmitter.init=function(){if(this._events===undefined||this._events===Object.getPrototypeOf(this)._events){this._events=Object.create(null);this._eventsCount=0}this._maxListeners=this._maxListeners||undefined};EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if(typeof n!=="number"||n<0||NumberIsNaN(n)){throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".")}this._maxListeners=n;return this};function _getMaxListeners(that){if(that._maxListeners===undefined)return EventEmitter.defaultMaxListeners;return that._maxListeners}EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this)};EventEmitter.prototype.emit=function emit(type){var args=[];for(var i=1;i<arguments.length;i++)args.push(arguments[i]);var doError=type==="error";var events=this._events;if(events!==undefined)doError=doError&&events.error===undefined;else if(!doError)return false;if(doError){var er;if(args.length>0)er=args[0];if(er instanceof Error){throw er}var err=new Error("Unhandled error."+(er?" ("+er.message+")":""));err.context=er;throw err}var handler=events[type];if(handler===undefined)return false;if(typeof handler==="function"){ReflectApply(handler,this,args)}else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)ReflectApply(listeners[i],this,args)}return true};function _addListener(target,type,listener,prepend){var m;var events;var existing;checkListener(listener);events=target._events;if(events===undefined){events=target._events=Object.create(null);target._eventsCount=0}else{if(events.newListener!==undefined){target.emit("newListener",type,listener.listener?listener.listener:listener);events=target._events}existing=events[type]}if(existing===undefined){existing=events[type]=listener;++target._eventsCount}else{if(typeof existing==="function"){existing=events[type]=prepend?[listener,existing]:[existing,listener]}else if(prepend){existing.unshift(listener)}else{existing.push(listener)}m=_getMaxListeners(target);if(m>0&&existing.length>m&&!existing.warned){existing.warned=true;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+" "+String(type)+" listeners "+"added. Use emitter.setMaxListeners() to "+"increase limit");w.name="MaxListenersExceededWarning";w.emitter=target;w.type=type;w.count=existing.length;ProcessEmitWarning(w)}}return target}EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,false)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,true)};function onceWrapper(){if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=true;if(arguments.length===0)return this.listener.call(this.target);return this.listener.apply(this.target,arguments)}}function _onceWrap(target,type,listener){var state={fired:false,wrapFn:undefined,target:target,type:type,listener:listener};var wrapped=onceWrapper.bind(state);wrapped.listener=listener;state.wrapFn=wrapped;return wrapped}EventEmitter.prototype.once=function once(type,listener){checkListener(listener);this.on(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){checkListener(listener);this.prependListener(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;checkListener(listener);events=this._events;if(events===undefined)return this;list=events[type];if(list===undefined)return this;if(list===listener||list.listener===listener){if(--this._eventsCount===0)this._events=Object.create(null);else{delete events[type];if(events.removeListener)this.emit("removeListener",type,list.listener||listener)}}else if(typeof list!=="function"){position=-1;for(i=list.length-1;i>=0;i--){if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener;position=i;break}}if(position<0)return this;if(position===0)list.shift();else{spliceOne(list,position)}if(list.length===1)events[type]=list[0];if(events.removeListener!==undefined)this.emit("removeListener",type,originalListener||listener)}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;events=this._events;if(events===undefined)return this;if(events.removeListener===undefined){if(arguments.length===0){this._events=Object.create(null);this._eventsCount=0}else if(events[type]!==undefined){if(--this._eventsCount===0)this._events=Object.create(null);else delete events[type]}return this}if(arguments.length===0){var keys=Object.keys(events);var key;for(i=0;i<keys.length;++i){key=keys[i];if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events=Object.create(null);this._eventsCount=0;return this}listeners=events[type];if(typeof listeners==="function"){this.removeListener(type,listeners)}else if(listeners!==undefined){for(i=listeners.length-1;i>=0;i--){this.removeListener(type,listeners[i])}}return this};function _listeners(target,type,unwrap){var events=target._events;if(events===undefined)return[];var evlistener=events[type];if(evlistener===undefined)return[];if(typeof evlistener==="function")return unwrap?[evlistener.listener||evlistener]:[evlistener];return unwrap?unwrapListeners(evlistener):arrayClone(evlistener,evlistener.length)}EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,true)};EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,false)};EventEmitter.listenerCount=function(emitter,type){if(typeof emitter.listenerCount==="function"){return emitter.listenerCount(type)}else{return listenerCount.call(emitter,type)}};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(type){var events=this._events;if(events!==undefined){var evlistener=events[type];if(typeof evlistener==="function"){return 1}else if(evlistener!==undefined){return evlistener.length}}return 0}EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(arr,n){var copy=new Array(n);for(var i=0;i<n;++i)copy[i]=arr[i];return copy}function spliceOne(list,index){for(;index+1<list.length;index++)list[index]=list[index+1];list.pop()}function unwrapListeners(arr){var ret=new Array(arr.length);for(var i=0;i<ret.length;++i){ret[i]=arr[i].listener||arr[i]}return ret}function once(emitter,name){return new Promise((function(resolve,reject){function errorListener(err){emitter.removeListener(name,resolver);reject(err)}function resolver(){if(typeof emitter.removeListener==="function"){emitter.removeListener("error",errorListener)}resolve([].slice.call(arguments))}eventTargetAgnosticAddListener(emitter,name,resolver,{once:true});if(name!=="error"){addErrorHandlerIfEventEmitter(emitter,errorListener,{once:true})}}))}function addErrorHandlerIfEventEmitter(emitter,handler,flags){if(typeof emitter.on==="function"){eventTargetAgnosticAddListener(emitter,"error",handler,flags)}}function eventTargetAgnosticAddListener(emitter,name,listener,flags){if(typeof emitter.on==="function"){if(flags.once){emitter.once(name,listener)}else{emitter.on(name,listener)}}else if(typeof emitter.addEventListener==="function"){emitter.addEventListener(name,(function wrapListener(arg){if(flags.once){emitter.removeEventListener(name,wrapListener)}listener(arg)}))}else{throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof emitter)}}},{}]},{},[1])(1)}));
